import java.sql.*;
import java.util.List;
import java.util.Scanner;

public class StudentImpl implements Istudent {

    IConnection icon = new ConnectionImpl();
    Scanner sc = new Scanner(System.in);

    // ✅ Insert single student (manual input)
    public void insertStudent() {
        try (Connection con = icon.getConnection()) {
            String query = "INSERT INTO students (id, name, age) VALUES (?, ?, ?)";
            PreparedStatement ps = con.prepareStatement(query);

            System.out.print("Enter ID: ");
            int id = sc.nextInt();
            sc.nextLine();
            System.out.print("Enter Name: ");
            String name = sc.nextLine();
            System.out.print("Enter Age: ");
            int age = sc.nextInt();

            ps.setInt(1, id);
            ps.setString(2, name);
            ps.setInt(3, age);

            ps.executeUpdate();
            System.out.println("✅ Student inserted successfully!");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Insert multiple students (manual input)
    public void insertMultipleStudents() {
        try (Connection con = icon.getConnection()) {
            String query = "INSERT INTO students (id, name, age) VALUES (?, ?, ?)";
            PreparedStatement ps = con.prepareStatement(query);

            System.out.print("Enter number of students: ");
            int n = sc.nextInt();

            for (int i = 0; i < n; i++) {
                System.out.println("\n--- Student " + (i + 1) + " ---");
                System.out.print("Enter ID: ");
                ps.setInt(1, sc.nextInt());
                sc.nextLine();
                System.out.print("Enter Name: ");
                ps.setString(2, sc.nextLine());
                System.out.print("Enter Age: ");
                ps.setInt(3, sc.nextInt());
                ps.addBatch();
            }

            int[] rows = ps.executeBatch();
            System.out.println("✅ " + rows.length + " students inserted successfully!");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Update a single student
    public void updateStudent() {
        try (Connection con = icon.getConnection()) {
            String query = "UPDATE students SET name=?, age=? WHERE id=?";
            PreparedStatement ps = con.prepareStatement(query);

            System.out.print("Enter ID to update: ");
            int id = sc.nextInt();
            sc.nextLine();
            System.out.print("Enter new Name: ");
            String name = sc.nextLine();
            System.out.print("Enter new Age: ");
            int age = sc.nextInt();

            ps.setString(1, name);
            ps.setInt(2, age);
            ps.setInt(3, id);

            int rows = ps.executeUpdate();
            System.out.println("✅ " + rows + " record(s) updated successfully!");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Update multiple students
    public void updateMultipleStudents() {
        try (Connection con = icon.getConnection()) {
            String query = "UPDATE students SET name=?, age=? WHERE id=?";
            PreparedStatement ps = con.prepareStatement(query);

            System.out.print("Enter number of students to update: ");
            int n = sc.nextInt();

            for (int i = 0; i < n; i++) {
                System.out.println("\n--- Student " + (i + 1) + " ---");
                System.out.print("Enter ID: ");
                int id = sc.nextInt();
                sc.nextLine();
                System.out.print("Enter new Name: ");
                String name = sc.nextLine();
                System.out.print("Enter new Age: ");
                int age = sc.nextInt();

                ps.setString(1, name);
                ps.setInt(2, age);
                ps.setInt(3, id);
                ps.addBatch();
            }

            int[] rows = ps.executeBatch();
            System.out.println("✅ " + rows.length + " students updated successfully!");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Delete a single student
    public void deleteStudent() {
        try (Connection con = icon.getConnection()) {
            String query = "DELETE FROM students WHERE id=?";
            PreparedStatement ps = con.prepareStatement(query);

            System.out.print("Enter ID to delete: ");
            int id = sc.nextInt();
            ps.setInt(1, id);

            int rows = ps.executeUpdate();
            System.out.println("✅ " + rows + " student deleted successfully!");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Delete multiple students
    public void deleteMultipleStudents() {
        try (Connection con = icon.getConnection()) {
            String query = "DELETE FROM students WHERE id=?";
            PreparedStatement ps = con.prepareStatement(query);

            System.out.print("Enter number of students to delete: ");
            int n = sc.nextInt();

            for (int i = 0; i < n; i++) {
                System.out.print("Enter ID: ");
                ps.setInt(1, sc.nextInt());
                ps.addBatch();
            }

            int[] rows = ps.executeBatch();
            System.out.println("✅ " + rows.length + " students deleted successfully!");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Show all students
    public void showStudents() {
        try (Connection con = icon.getConnection();
             Statement st = con.createStatement();
             ResultSet rs = st.executeQuery("SELECT * FROM students")) {

            System.out.println("\nID\tName\tAge");
            System.out.println("--------------------");
            while (rs.next()) {
                System.out.println(rs.getInt("id") + "\t" + rs.getString("name") + "\t" + rs.getInt("age"));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ✅ Methods from interface (parameterized ones)
    @Override
    public void insertStudent(Student s) {
        try (Connection con = icon.getConnection()) {
            String query = "INSERT INTO students (id, name, age) VALUES (?, ?, ?)";
            PreparedStatement ps = con.prepareStatement(query);
            ps.setInt(1, s.getId());
            ps.setString(2, s.getName());
            ps.setInt(3, s.getAge());
            ps.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Override
    public void insertMultipleStudents(List<Student> students) {
        try (Connection con = icon.getConnection()) {
            String query = "INSERT INTO students (id, name, age) VALUES (?, ?, ?)";
            PreparedStatement ps = con.prepareStatement(query);

            for (Student s : students) {
                ps.setInt(1, s.getId());
                ps.setString(2, s.getName());
                ps.setInt(3, s.getAge());
                ps.addBatch();
            }

            ps.executeBatch();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Override
    public void updateMultipleStudents(List<Student> students) {
        try (Connection con = icon.getConnection()) {
            String query = "UPDATE students SET name=?, age=? WHERE id=?";
            PreparedStatement ps = con.prepareStatement(query);

            for (Student s : students) {
                ps.setString(1, s.getName());
                ps.setInt(2, s.getAge());
                ps.setInt(3, s.getId());
                ps.addBatch();
            }

            ps.executeBatch();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Override
    public void deleteMultipleStudents(List<Integer> ids) {
        try (Connection con = icon.getConnection()) {
            String query = "DELETE FROM students WHERE id=?";
            PreparedStatement ps = con.prepareStatement(query);

            for (int id : ids) {
                ps.setInt(1, id);
                ps.addBatch();
            }

            ps.executeBatch();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Override
    public void insertMultiple(List<Student> list) {
        // Not needed if you already use insertMultipleStudents()
    }
}
